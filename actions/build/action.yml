name: Build
inputs:
  prefix: 
    default: ""
  env-type:
    required: true
    default: None

#   hw-type:
    # required: true
    # default: None

outputs:
  random-number:
    value: 13
runs:
  using: "composite"
  steps:
    # if ${{ inputs.env-type  == 'docker'}}; then
    #   source /usr/share/miniconda/etc/profile.d/conda.sh
    #   conda activate omnisci-dev
    # fi;

    - name: Build
      env:
        CPU_COUNT: 2
      run: |
        echo ${PWD}
        ls -la 
        echo "prefix: " ${{ inputs.prefix }}
        if ${{ inputs.env-type  == 'conda'}}; then
          source /usr/share/miniconda/etc/profile.d/conda.sh
          conda activate omnisci-dev
        fi;
        docker container ls -a
        ${{ inputs.prefix }} ls -la && mkdir build && cd build
        ${{ inputs.prefix }} ls -la && cmake ..
        ${{ inputs.prefix }} make -j ${{ env.CPU_COUNT }}
        ${{ inputs.prefix }} make install
        ${{ inputs.prefix }} cd ..
        ${{ inputs.prefix }} tar -zcf /tmp/build.tgz .
      shell: bash
